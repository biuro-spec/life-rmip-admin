<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life RMiP - Panel Dyspozytorski</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css?v=14">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="assets/logo.png" alt="Life" class="sidebar-logo">
            <span class="sidebar-title">Life RMiP</span>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-view="dashboard">
                <span class="material-icons-round">dashboard</span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item nav-parent" id="nav-new-order-toggle">
                <span class="material-icons-round">add_circle</span>
                <span>Nowe zlecenie</span>
                <span class="material-icons-round nav-arrow">expand_more</span>
            </a>
            <div class="nav-submenu" id="nav-new-order-sub">
                <a href="#" class="nav-sub-item" data-contractor="Szpital Racibórz">
                    <span class="material-icons-round">local_hospital</span>
                    Szpital Racibórz
                </a>
                <a href="#" class="nav-sub-item" data-contractor="ScanMed">
                    <span class="material-icons-round">medical_services</span>
                    ScanMed
                </a>
                <a href="#" class="nav-sub-item" data-contractor="Kietrz">
                    <span class="material-icons-round">apartment</span>
                    Kietrz
                </a>
                <a href="#" class="nav-sub-item" data-contractor="POZ Krzyżanowice">
                    <span class="material-icons-round">health_and_safety</span>
                    POZ Krzyżanowice
                </a>
                <a href="#" class="nav-sub-item" data-contractor="NFZ">
                    <span class="material-icons-round">account_balance</span>
                    NFZ
                </a>
                <a href="#" class="nav-sub-item" data-contractor="Prywatne">
                    <span class="material-icons-round">person</span>
                    Prywatne
                </a>
            </div>
            <a href="#" class="nav-item" data-view="orders">
                <span class="material-icons-round">list_alt</span>
                <span>Zlecenia</span>
            </a>
            <a href="#" class="nav-item" data-view="calculator">
                <span class="material-icons-round">calculate</span>
                <span>Kalkulator cen</span>
            </a>
            <a href="#" class="nav-item" data-view="reports">
                <span class="material-icons-round">assessment</span>
                <span>Rozliczenia</span>
            </a>
            <a href="#" class="nav-item" data-view="workers">
                <span class="material-icons-round">people</span>
                <span>Pracownicy</span>
            </a>
            <a href="#" class="nav-item" data-view="patients">
                <span class="material-icons-round">personal_injury</span>
                <span>Pacjenci</span>
            </a>
            <a href="#" class="nav-item" data-view="map">
                <span class="material-icons-round">map</span>
                <span>Mapa karetek</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="dispatcher-info">
                <span class="material-icons-round">admin_panel_settings</span>
                <span id="dispatcher-name">Dyspozytor</span>
            </div>
            <button class="logout-link" id="admin-logout">Wyloguj</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <button class="menu-toggle" id="menu-toggle">
                <span class="material-icons-round">menu</span>
            </button>
            <h1 class="page-title" id="page-title">Dashboard</h1>
            <div class="topbar-right">
                <span class="current-time" id="current-time"></span>
            </div>
        </header>

        <!-- Views Container -->
        <div class="content-area">

            <!-- ==================== DASHBOARD ==================== -->
            <section class="view active" id="view-dashboard">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon" style="background: #eff6ff; color: #2563eb;">
                                <span class="material-icons-round">event_note</span>
                            </div>
                        </div>
                        <span class="stat-label">Zlecenia dzisiaj</span>
                        <span class="stat-value" id="stat-today-total">0</span>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon" style="background: #fff7ed; color: #ea580c;">
                                <span class="material-icons-round">directions_car</span>
                            </div>
                        </div>
                        <span class="stat-label">W trakcie</span>
                        <span class="stat-value" id="stat-in-progress">0</span>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon" style="background: #f0fdf4; color: #16a34a;">
                                <span class="material-icons-round">check_circle</span>
                            </div>
                        </div>
                        <span class="stat-label">Zakończone</span>
                        <span class="stat-value" id="stat-completed">0</span>
                    </div>
                    <div class="stat-card">
                        <div class="stat-card-header">
                            <div class="stat-icon" style="background: rgba(181,28,28,0.05); color: #b51c1c;">
                                <span class="material-icons-round">schedule</span>
                            </div>
                        </div>
                        <span class="stat-label">Zaplanowane</span>
                        <span class="stat-value" id="stat-scheduled">0</span>
                    </div>
                </div>

                <!-- Workers Status -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>Status pracowników</h2>
                        <button class="btn-icon" onclick="loadDashboard()">
                            <span class="material-icons-round">refresh</span>
                        </button>
                    </div>
                    <div class="workers-grid" id="workers-status-grid">
                        <!-- Wypełniane przez JS -->
                    </div>
                </div>

                <!-- Today's Orders -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>Zlecenia na dzisiaj</h2>
                        <button class="btn-sm btn-primary" onclick="showView('new-order')">
                            <span class="material-icons-round">add</span> Nowe zlecenie
                        </button>
                    </div>
                    <div class="orders-table-container">
                        <table class="data-table" id="dashboard-orders-table">
                            <thead>
                                <tr>
                                    <th>Godz.</th>
                                    <th>Pacjent</th>
                                    <th>Trasa</th>
                                    <th>Kontrahent</th>
                                    <th>Pracownik</th>
                                    <th>Karetka</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-orders-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ==================== NOWE ZLECENIE ==================== -->
            <section class="view" id="view-new-order">
                <div class="panel" style="max-width: 900px;">
                    <div class="panel-header">
                        <h2>Nowe zlecenie transportu</h2>
                    </div>
                    <form id="order-form" class="order-form">
                        <!-- Wiersz 1: Kontrahent + Pilność -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Kontrahent *</label>
                                <select id="f-contractor" required>
                                    <option value="">-- Wybierz --</option>
                                    <option value="Szpital Racibórz">Szpital Racibórz</option>
                                    <option value="ScanMed">ScanMed</option>
                                    <option value="Kietrz">Kietrz</option>
                                    <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                    <option value="NFZ">NFZ</option>
                                    <option value="Prywatne">Prywatne</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Typ transportu</label>
                                <select id="f-transport-type">
                                    <option value="Transport sanitarny">Transport sanitarny</option>
                                    <option value="Transport medyczny">Transport medyczny</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pilność *</label>
                                <select id="f-urgency" required>
                                    <option value="Zaplanowane">Zaplanowane</option>
                                    <option value="Pilne">Pilne</option>
                                </select>
                            </div>
                        </div>

                        <!-- Wiersz 2: Data + Godzina -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Data transportu *</label>
                                <input type="date" id="f-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Godzina *</label>
                                <input type="time" id="f-time" required>
                            </div>
                        </div>

                        <h3 class="form-section-title">Dane pacjenta</h3>

                        <!-- Wiersz 3: Pacjent -->
                        <div class="form-row">
                            <div class="form-group flex-2 patient-input-wrap">
                                <label class="form-label">Imię i nazwisko *</label>
                                <input type="text" id="f-patient-name" required placeholder="np. Kowalski Jan" autocomplete="off">
                                <div class="patient-suggestions" id="patient-suggestions"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">PESEL</label>
                                <input type="text" id="f-pesel" maxlength="11" placeholder="00000000000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefon</label>
                                <input type="tel" id="f-phone" placeholder="+48 500 000 000">
                            </div>
                        </div>

                        <!-- Wiersz 4: Typ pacjenta -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Typ pacjenta *</label>
                                <select id="f-patient-type" required>
                                    <option value="Siedzący">Siedzący</option>
                                    <option value="Leżący">Leżący</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rodzina może pomóc?</label>
                                <select id="f-family-help">
                                    <option value="Nie">Nie</option>
                                    <option value="Tak">Tak</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="form-section-title">Trasa</h3>

                        <!-- Baza startowa -->
                        <div class="route-point">
                            <div class="route-marker start">A</div>
                            <div class="form-group" style="flex:1;">
                                <label class="form-label">Baza (start)</label>
                                <input type="text" id="f-base" value="Rudzka 14, Racibórz" placeholder="Adres bazy">
                            </div>
                        </div>

                        <!-- Przystanki dynamiczne -->
                        <div id="f-stops">
                            <div class="route-point" data-stop="1">
                                <div class="route-marker stop">1</div>
                                <div class="form-group" style="flex:1;">
                                    <label class="form-label">Przystanek 1 (np. adres pacjenta) *</label>
                                    <input type="text" class="f-stop-input" placeholder="Wpisz adres..." required>
                                </div>
                                <button type="button" class="btn-remove-stop" onclick="removeOrderStop(this)" title="Usuń">
                                    <span class="material-icons-round">close</span>
                                </button>
                            </div>
                        </div>

                        <button type="button" class="btn-add-stop" onclick="addOrderStop()">
                            <span class="material-icons-round">add_location</span>
                            Dodaj przystanek
                        </button>

                        <!-- Powrót na bazę -->
                        <div class="route-point">
                            <div class="route-marker end">
                                <span class="material-icons-round" style="font-size:16px;">home</span>
                            </div>
                            <div style="flex:1; padding:10px 0;">
                                <label style="display:flex; align-items:center; gap:8px; cursor:pointer; font-size:14px;">
                                    <input type="checkbox" id="f-return-base" checked>
                                    Powrót na bazę (Rudzka 14)
                                </label>
                            </div>
                        </div>

                        <!-- Przycisk oblicz trasę -->
                        <button type="button" class="btn-maps" id="btn-order-route" onclick="calcOrderRoute()" style="margin: 12px 0 16px; width:100%;">
                            <span class="material-icons-round">route</span>
                            Oblicz trasę z Google Maps
                        </button>

                        <!-- Wynik trasy -->
                        <div id="order-route-info" style="display:none; margin-bottom:8px;"></div>
                        <div id="order-route-legs" style="display:none; margin-bottom:12px;"></div>

                        <!-- Podsumowanie: km, czas, koszt -->
                        <div class="order-route-summary" id="order-route-summary" style="display:none;">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Kilometry</label>
                                    <input type="number" id="f-km" value="" min="0" step="1" placeholder="0" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Czas jazdy (h)</label>
                                    <input type="number" id="f-hours" value="" min="0" step="0.01" placeholder="0" readonly>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Koszt czasu</label>
                                    <input type="text" id="f-cost-time" value="" readonly style="background:#f5f5f5;">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Koszt km</label>
                                    <input type="text" id="f-cost-km" value="" readonly style="background:#f5f5f5;">
                                </div>
                            </div>
                            <div class="order-route-total">
                                <span>Szacunkowy koszt:</span>
                                <strong id="f-cost-total">0 zł</strong>
                            </div>
                        </div>

                        <h3 class="form-section-title">Przypisanie</h3>

                        <!-- Wiersz 6: Pracownik + Karetka -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Karetka</label>
                                <select id="f-vehicle">
                                    <option value="">-- Później --</option>
                                    <option value="1">Karetka 1</option>
                                    <option value="2">Karetka 2</option>
                                    <option value="3">Karetka 3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pracownik 1</label>
                                <select id="f-worker1">
                                    <option value="">-- Później --</option>
                                    <option value="Krzysztof">Krzysztof</option>
                                    <option value="Aleks">Aleks</option>
                                    <option value="Waldemar">Waldemar</option>
                                    <option value="Dawid">Dawid</option>
                                    <option value="Piotrek">Piotrek</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pracownik 2 (leżący)</label>
                                <select id="f-worker2">
                                    <option value="">-- Nie dotyczy --</option>
                                    <option value="Krzysztof">Krzysztof</option>
                                    <option value="Aleks">Aleks</option>
                                    <option value="Waldemar">Waldemar</option>
                                    <option value="Dawid">Dawid</option>
                                    <option value="Piotrek">Piotrek</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="form-section-title">Dodatkowe</h3>

                        <!-- Wiersz 7: Uwagi -->
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label class="form-label">Uwagi medyczne</label>
                                <textarea id="f-medical-notes" rows="2" placeholder="Tlen, defibrylator, specjalne wymagania..."></textarea>
                            </div>
                            <div class="form-group flex-2">
                                <label class="form-label">Inne uwagi</label>
                                <textarea id="f-notes" rows="2" placeholder="Dodatkowe informacje..."></textarea>
                            </div>
                        </div>

                        <!-- Stawki (auto) -->
                        <div class="rate-preview" id="rate-preview" style="display: none;">
                            <div class="rate-info">
                                <span class="material-icons-round">payments</span>
                                <span>Stawka: <strong id="rate-hourly">0</strong> zł/h + <strong id="rate-km">0</strong> zł/km</span>
                            </div>
                        </div>

                        <!-- Przycisk -->
                        <div class="form-actions">
                            <button type="button" class="btn-outline" onclick="resetOrderForm()">Wyczyść</button>
                            <button type="submit" class="btn-primary-lg">
                                <span class="material-icons-round">save</span>
                                Utwórz zlecenie
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- ==================== LISTA ZLECEŃ ==================== -->
            <section class="view" id="view-orders">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Wszystkie zlecenia</h2>
                        <div class="filters-row">
                            <input type="date" id="filter-date" class="filter-input">
                            <select id="filter-contractor" class="filter-input">
                                <option value="">Wszyscy kontrahenci</option>
                                <option value="Szpital Racibórz">Szpital Racibórz</option>
                                <option value="ScanMed">ScanMed</option>
                                <option value="Kietrz">Kietrz</option>
                                <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                <option value="NFZ">NFZ</option>
                                <option value="Prywatne">Prywatne</option>
                            </select>
                            <select id="filter-status" class="filter-input">
                                <option value="">Wszystkie statusy</option>
                                <option value="Zaplanowane">Zaplanowane</option>
                                <option value="W trasie do pacjenta">W trasie</option>
                                <option value="Z pacjentem">Z pacjentem</option>
                                <option value="Zakończone">Zakończone</option>
                                <option value="Do rozliczenia">Do rozliczenia</option>
                                <option value="Rozliczone">Rozliczone</option>
                            </select>
                            <button class="btn-sm btn-primary" onclick="loadOrdersList()">
                                <span class="material-icons-round">search</span> Szukaj
                            </button>
                            <button class="btn-sm btn-secondary" onclick="optimizeOrderRoute()" title="Optymalizuj trasę dla wybranej daty">
                                <span class="material-icons-round">route</span> Optymalizuj trasę
                            </button>
                        </div>
                    </div>
                    <div class="orders-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data</th>
                                    <th>Godz.</th>
                                    <th>Pacjent</th>
                                    <th>Skąd</th>
                                    <th>Dokąd</th>
                                    <th>Kontrahent</th>
                                    <th>Pracownik</th>
                                    <th>Status</th>
                                    <th>Kwota</th>
                                </tr>
                            </thead>
                            <tbody id="orders-list-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ==================== KALKULATOR CEN ==================== -->
            <section class="view" id="view-calculator">
                <div class="panel" style="max-width: 700px;">
                    <div class="panel-header">
                        <h2>Kalkulator cen</h2>
                    </div>
                    <div class="calculator-form">
                        <!-- Baza startowa -->
                        <div class="route-point">
                            <div class="route-marker start">A</div>
                            <div class="form-group" style="flex:1;">
                                <label class="form-label">Baza (start)</label>
                                <input type="text" id="calc-base" value="Rudzka 14, Racibórz" placeholder="Adres bazy">
                            </div>
                        </div>

                        <!-- Przystanki dynamiczne -->
                        <div id="calc-stops">
                            <div class="route-point" data-stop="1">
                                <div class="route-marker stop">1</div>
                                <div class="form-group" style="flex:1;">
                                    <label class="form-label">Przystanek 1 (np. dom pacjenta)</label>
                                    <input type="text" class="calc-stop-input" placeholder="Wpisz adres...">
                                </div>
                                <button type="button" class="btn-remove-stop" onclick="removeStop(this)" title="Usuń">
                                    <span class="material-icons-round">close</span>
                                </button>
                            </div>
                            <div class="route-point" data-stop="2">
                                <div class="route-marker stop">2</div>
                                <div class="form-group" style="flex:1;">
                                    <label class="form-label">Przystanek 2 (np. poradnia)</label>
                                    <input type="text" class="calc-stop-input" placeholder="Wpisz adres...">
                                </div>
                                <button type="button" class="btn-remove-stop" onclick="removeStop(this)" title="Usuń">
                                    <span class="material-icons-round">close</span>
                                </button>
                            </div>
                        </div>

                        <button type="button" class="btn-add-stop" onclick="addStop()">
                            <span class="material-icons-round">add_location</span>
                            Dodaj przystanek
                        </button>

                        <!-- Powrót na bazę -->
                        <div class="route-point">
                            <div class="route-marker end">
                                <span class="material-icons-round" style="font-size:16px;">home</span>
                            </div>
                            <div style="flex:1; padding:10px 0;">
                                <label style="display:flex; align-items:center; gap:8px; cursor:pointer; font-size:14px;">
                                    <input type="checkbox" id="calc-return" checked>
                                    Powrót na bazę (Rudzka 14)
                                </label>
                            </div>
                        </div>

                        <!-- Przycisk trasy -->
                        <button type="button" class="btn-maps" id="btn-fetch-route" onclick="fetchRouteFromMaps()" style="margin: 12px 0 16px; width:100%;">
                            <span class="material-icons-round">route</span>
                            Oblicz trasę z Google Maps
                        </button>

                        <!-- Info o trasie -->
                        <div id="route-info" style="display:none; margin-bottom:12px;"></div>
                        <div id="route-legs" style="display:none; margin-bottom:16px;"></div>

                        <!-- Dane do kalkulacji -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Kilometry (suma)</label>
                                <input type="number" id="calc-km" placeholder="0" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Czas jazdy (h)</label>
                                <input type="number" id="calc-hours" placeholder="0" min="0" step="0.01">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stawka zł/h</label>
                                <input type="number" id="calc-rate-h" value="80" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stawka zł/km</label>
                                <input type="number" id="calc-rate-km" value="4" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Upust/rabat (zł)</label>
                                <input type="number" id="calc-discount" value="0" min="0">
                            </div>
                        </div>
                        <button type="button" class="btn-primary-lg" onclick="calculatePrice()" style="margin-top: 16px;">
                            <span class="material-icons-round">calculate</span>
                            Oblicz cenę
                        </button>

                        <div class="calc-result" id="calc-result" style="display: none;">
                            <div class="calc-result-row">
                                <span>Koszt czasu:</span>
                                <span id="calc-time-cost">0 zł</span>
                            </div>
                            <div class="calc-result-row">
                                <span>Koszt km:</span>
                                <span id="calc-km-cost">0 zł</span>
                            </div>
                            <div class="calc-result-row">
                                <span>Cena bazowa:</span>
                                <span id="calc-base-price">0 zł</span>
                            </div>
                            <div class="calc-result-row">
                                <span>Upust:</span>
                                <span id="calc-discount-val">0 zł</span>
                            </div>
                            <div class="calc-result-row total">
                                <span>CENA FINALNA:</span>
                                <span id="calc-final-price">0 zł</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== ROZLICZENIA ==================== -->
            <section class="view" id="view-reports">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Rozliczenia miesięczne</h2>
                    </div>
                    <div class="form-row" style="margin-bottom: 24px;">
                        <div class="form-group">
                            <label class="form-label">Kontrahent</label>
                            <select id="report-contractor">
                                <option value="Szpital Racibórz">Szpital Racibórz</option>
                                <option value="ScanMed">ScanMed</option>
                                <option value="Kietrz">Kietrz</option>
                                <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                <option value="Prywatne">Prywatne</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Miesiąc</label>
                            <select id="report-month">
                                <option value="1">Styczeń</option>
                                <option value="2" selected>Luty</option>
                                <option value="3">Marzec</option>
                                <option value="4">Kwiecień</option>
                                <option value="5">Maj</option>
                                <option value="6">Czerwiec</option>
                                <option value="7">Lipiec</option>
                                <option value="8">Sierpień</option>
                                <option value="9">Wrzesień</option>
                                <option value="10">Październik</option>
                                <option value="11">Listopad</option>
                                <option value="12">Grudzień</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rok</label>
                            <input type="number" id="report-year" value="2026" min="2025" max="2030">
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn-sm btn-primary" onclick="loadReport()">
                                <span class="material-icons-round">assessment</span> Pokaż raport
                            </button>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn-sm btn-success" onclick="generateBillingSheet()">
                                <span class="material-icons-round">table_chart</span> Generuj arkusz
                            </button>
                        </div>
                    </div>

                    <!-- Report Results -->
                    <div id="report-results" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-orders">0</span>
                                    <span class="stat-label">Zleceń</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-hours">0</span>
                                    <span class="stat-label">Godzin</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-km">0</span>
                                    <span class="stat-label">Kilometrów</span>
                                </div>
                            </div>
                            <div class="stat-card highlight">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-total">0 zł</span>
                                    <span class="stat-label">Suma</span>
                                </div>
                            </div>
                        </div>
                        <div class="orders-table-container" style="margin-top: 16px;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Pacjent</th>
                                        <th>Trasa</th>
                                        <th>Czas (h)</th>
                                        <th>Km</th>
                                        <th>Kwota czas</th>
                                        <th>Kwota km</th>
                                        <th>Łącznie</th>
                                    </tr>
                                </thead>
                                <tbody id="report-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== PRACOWNICY ==================== -->
            <section class="view" id="view-workers">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Pracownicy</h2>
                    </div>
                    <div class="workers-detail-grid" id="workers-detail-grid">
                        <!-- Wypełniane przez JS -->
                    </div>
                </div>
            </section>

            <!-- ==================== PACJENCI ==================== -->
            <section class="view" id="view-patients">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Baza pacjentów</h2>
                        <div class="patients-search-wrap">
                            <span class="material-icons-round patients-search-icon">search</span>
                            <input type="text" id="patients-search" class="patients-search-input" placeholder="Szukaj pacjenta...">
                        </div>
                    </div>
                    <div class="patients-stats" id="patients-stats"></div>
                    <div class="table-container">
                        <table class="data-table" id="patients-table">
                            <thead>
                                <tr>
                                    <th>Pacjent</th>
                                    <th>PESEL</th>
                                    <th>Telefon</th>
                                    <th>Typ</th>
                                    <th>Zleceń</th>
                                    <th>Ostatnie</th>
                                    <th>Uwagi</th>
                                </tr>
                            </thead>
                            <tbody id="patients-tbody">
                                <!-- Wypełniane przez JS -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ==================== MAPA KARETEK ==================== -->
            <section class="view" id="view-map">
                <div class="map-controls">
                    <div class="map-controls-left">
                        <button class="btn-sm btn-primary" onclick="refreshMapPositions()">
                            <span class="material-icons-round">refresh</span> Odśwież
                        </button>
                        <label class="map-auto-refresh">
                            <input type="checkbox" id="map-auto-refresh" checked>
                            <span>Auto-odświeżanie (60s)</span>
                        </label>
                    </div>
                    <div class="map-legend">
                        <span class="map-legend-item"><span class="map-legend-dot" style="background:#22c55e;"></span> Wolny</span>
                        <span class="map-legend-item"><span class="map-legend-dot" style="background:#f59e0b;"></span> W trasie</span>
                        <span class="map-legend-item"><span class="map-legend-dot" style="background:#ef4444;"></span> Z pacjentem</span>
                        <span class="map-legend-item"><span class="map-legend-dot" style="background:#6b7280;"></span> Nieaktywna</span>
                    </div>
                </div>
                <div class="map-wrapper">
                    <div id="ambulance-map" class="ambulance-map"></div>
                    <div class="map-sidebar" id="map-sidebar">
                        <h3 class="map-sidebar-title">Karetki</h3>
                        <div id="map-vehicle-list" class="map-vehicle-list">
                            <!-- Wypełniane przez JS -->
                        </div>
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Modal edycji zlecenia -->
    <div class="modal-overlay" id="edit-modal" style="display:none;">
        <div class="modal">
            <div class="modal-header">
                <h3><span class="material-icons-round">edit</span> Edycja zlecenia <span id="edit-order-id"></span></h3>
                <button class="modal-close" onclick="closeEditModal()">
                    <span class="material-icons-round">close</span>
                </button>
            </div>
            <div class="modal-body">
                <div class="modal-section">
                    <h4>Dane transportu</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Data</label>
                            <input type="date" id="edit-date">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Godzina</label>
                            <input type="time" id="edit-time">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select id="edit-status">
                                <option value="Zaplanowane">Zaplanowane</option>
                                <option value="W trasie do pacjenta">W trasie</option>
                                <option value="Z pacjentem">Z pacjentem</option>
                                <option value="Zakończone">Zakończone</option>
                                <option value="Do rozliczenia">Do rozliczenia</option>
                                <option value="Rozliczone">Rozliczone</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pilność</label>
                            <select id="edit-urgency">
                                <option value="Zaplanowane">Zaplanowane</option>
                                <option value="Pilne">Pilne</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h4>Pacjent</h4>
                    <div class="form-row">
                        <div class="form-group flex-2 patient-input-wrap">
                            <label class="form-label">Imię i nazwisko</label>
                            <input type="text" id="edit-patient-name" autocomplete="off">
                            <div class="patient-suggestions" id="edit-patient-suggestions"></div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">PESEL</label>
                            <input type="text" id="edit-pesel" maxlength="11">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Telefon</label>
                            <input type="tel" id="edit-phone">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Typ pacjenta</label>
                            <select id="edit-patient-type">
                                <option value="Siedzący">Siedzący</option>
                                <option value="Leżący">Leżący</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pomoc rodziny</label>
                            <select id="edit-family-help">
                                <option value="Nie">Nie</option>
                                <option value="Tak">Tak</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h4>Trasa</h4>
                    <div class="form-row">
                        <div class="form-group flex-2">
                            <label class="form-label">Skąd</label>
                            <input type="text" id="edit-from" class="edit-address">
                        </div>
                        <div class="form-group flex-2">
                            <label class="form-label">Dokąd</label>
                            <input type="text" id="edit-to" class="edit-address">
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h4>Przypisanie</h4>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Kontrahent</label>
                            <select id="edit-contractor">
                                <option value="">-- Brak --</option>
                                <option value="Szpital Racibórz">Szpital Racibórz</option>
                                <option value="ScanMed">ScanMed</option>
                                <option value="Kietrz">Kietrz</option>
                                <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                <option value="NFZ">NFZ</option>
                                <option value="Prywatne">Prywatne</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Typ transportu</label>
                            <select id="edit-transport-type">
                                <option value="">-</option>
                                <option value="Transport sanitarny">Sanitarny</option>
                                <option value="Transport medyczny">Medyczny</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Karetka</label>
                            <select id="edit-vehicle">
                                <option value="">-- Brak --</option>
                                <option value="1">Karetka 1</option>
                                <option value="2">Karetka 2</option>
                                <option value="3">Karetka 3</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Pracownik 1</label>
                            <select id="edit-worker1">
                                <option value="">-- Brak --</option>
                                <option value="Krzysztof">Krzysztof</option>
                                <option value="Aleks">Aleks</option>
                                <option value="Waldemar">Waldemar</option>
                                <option value="Dawid">Dawid</option>
                                <option value="Piotrek">Piotrek</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Pracownik 2</label>
                            <select id="edit-worker2">
                                <option value="">-- Brak --</option>
                                <option value="Krzysztof">Krzysztof</option>
                                <option value="Aleks">Aleks</option>
                                <option value="Waldemar">Waldemar</option>
                                <option value="Dawid">Dawid</option>
                                <option value="Piotrek">Piotrek</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-section">
                    <h4>Uwagi</h4>
                    <div class="form-group">
                        <label class="form-label">Uwagi medyczne</label>
                        <textarea id="edit-medical-notes" rows="2" placeholder="Np. pacjent wymaga tlenu, noszowe..."></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Uwagi ogólne</label>
                        <textarea id="edit-notes" rows="3" placeholder="Dodatkowe informacje..."></textarea>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeEditModal()">Anuluj</button>
                <button type="button" class="btn-primary-lg" id="edit-save-btn" onclick="saveOrder()">
                    <span class="material-icons-round">save</span>
                    Zapisz zmiany
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon material-icons-round" id="toast-icon">check_circle</span>
        <span class="toast-message" id="toast-message"></span>
    </div>

    <!-- Scripts -->
    <!-- UWAGA BEZPIECZEŃSTWO: Klucz Google Maps API należy chronić ograniczeniami HTTP Referrer
         w Google Cloud Console: https://console.cloud.google.com/apis/credentials
         Ogranicz użycie do zaufanych domen (np. tylko twoja-domena.pl, script.google.com) -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0tTZTp2bZBb2cbbSBcnxEoPXERnfx1w8&libraries=places&language=pl"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/admin.js?v=14"></script>
</body>
</html>
