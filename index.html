<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Life RMiP - Panel Dyspozytorski</title>
    <link rel="icon" type="image/png" href="assets/logo.png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">
    <link rel="stylesheet" href="css/admin.css">
</head>
<body>
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <img src="assets/logo.png" alt="Life" class="sidebar-logo">
            <span class="sidebar-title">Life RMiP</span>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-view="dashboard">
                <span class="material-icons-round">dashboard</span>
                <span>Dashboard</span>
            </a>
            <a href="#" class="nav-item" data-view="new-order">
                <span class="material-icons-round">add_circle</span>
                <span>Nowe zlecenie</span>
            </a>
            <a href="#" class="nav-item" data-view="orders">
                <span class="material-icons-round">list_alt</span>
                <span>Zlecenia</span>
            </a>
            <a href="#" class="nav-item" data-view="calculator">
                <span class="material-icons-round">calculate</span>
                <span>Kalkulator cen</span>
            </a>
            <a href="#" class="nav-item" data-view="reports">
                <span class="material-icons-round">assessment</span>
                <span>Rozliczenia</span>
            </a>
            <a href="#" class="nav-item" data-view="workers">
                <span class="material-icons-round">people</span>
                <span>Pracownicy</span>
            </a>
        </nav>
        <div class="sidebar-footer">
            <div class="dispatcher-info">
                <span class="material-icons-round">admin_panel_settings</span>
                <span id="dispatcher-name">Dyspozytor</span>
            </div>
            <button class="logout-link" id="admin-logout">Wyloguj</button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <!-- Top Bar -->
        <header class="topbar">
            <button class="menu-toggle" id="menu-toggle">
                <span class="material-icons-round">menu</span>
            </button>
            <h1 class="page-title" id="page-title">Dashboard</h1>
            <div class="topbar-right">
                <span class="current-time" id="current-time"></span>
            </div>
        </header>

        <!-- Views Container -->
        <div class="content-area">

            <!-- ==================== DASHBOARD ==================== -->
            <section class="view active" id="view-dashboard">
                <!-- Stats Cards -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #E3F2FD; color: #1565C0;">
                            <span class="material-icons-round">event_note</span>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-today-total">0</span>
                            <span class="stat-label">Zlecenia dzisiaj</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #FFF3E0; color: #E65100;">
                            <span class="material-icons-round">directions_car</span>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-in-progress">0</span>
                            <span class="stat-label">W trakcie</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #E8F5E9; color: #2E7D32;">
                            <span class="material-icons-round">check_circle</span>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-completed">0</span>
                            <span class="stat-label">Zakończone</span>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon" style="background: #FCE4EC; color: #B71C1C;">
                            <span class="material-icons-round">schedule</span>
                        </div>
                        <div class="stat-info">
                            <span class="stat-value" id="stat-scheduled">0</span>
                            <span class="stat-label">Zaplanowane</span>
                        </div>
                    </div>
                </div>

                <!-- Workers Status -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>Status pracowników</h2>
                        <button class="btn-icon" onclick="loadDashboard()">
                            <span class="material-icons-round">refresh</span>
                        </button>
                    </div>
                    <div class="workers-grid" id="workers-status-grid">
                        <!-- Wypełniane przez JS -->
                    </div>
                </div>

                <!-- Today's Orders -->
                <div class="panel">
                    <div class="panel-header">
                        <h2>Zlecenia na dzisiaj</h2>
                        <button class="btn-sm btn-primary" onclick="showView('new-order')">
                            <span class="material-icons-round">add</span> Nowe zlecenie
                        </button>
                    </div>
                    <div class="orders-table-container">
                        <table class="data-table" id="dashboard-orders-table">
                            <thead>
                                <tr>
                                    <th>Godz.</th>
                                    <th>Pacjent</th>
                                    <th>Trasa</th>
                                    <th>Kontrahent</th>
                                    <th>Pracownik</th>
                                    <th>Karetka</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-orders-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ==================== NOWE ZLECENIE ==================== -->
            <section class="view" id="view-new-order">
                <div class="panel" style="max-width: 900px;">
                    <div class="panel-header">
                        <h2>Nowe zlecenie transportu</h2>
                    </div>
                    <form id="order-form" class="order-form">
                        <!-- Wiersz 1: Kontrahent + Pilność -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Kontrahent *</label>
                                <select id="f-contractor" required>
                                    <option value="">-- Wybierz --</option>
                                    <option value="Szpital Racibórz">Szpital Racibórz</option>
                                    <option value="ScanMed">ScanMed</option>
                                    <option value="Kietrz">Kietrz</option>
                                    <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                    <option value="NFZ">NFZ</option>
                                    <option value="Prywatne">Prywatne</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Typ transportu</label>
                                <select id="f-transport-type">
                                    <option value="Transport sanitarny">Transport sanitarny</option>
                                    <option value="Transport medyczny">Transport medyczny</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pilność *</label>
                                <select id="f-urgency" required>
                                    <option value="Zaplanowane">Zaplanowane</option>
                                    <option value="Pilne">Pilne</option>
                                </select>
                            </div>
                        </div>

                        <!-- Wiersz 2: Data + Godzina -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Data transportu *</label>
                                <input type="date" id="f-date" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Godzina *</label>
                                <input type="time" id="f-time" required>
                            </div>
                        </div>

                        <h3 class="form-section-title">Dane pacjenta</h3>

                        <!-- Wiersz 3: Pacjent -->
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label class="form-label">Imię i nazwisko *</label>
                                <input type="text" id="f-patient-name" required placeholder="np. Kowalski Jan">
                            </div>
                            <div class="form-group">
                                <label class="form-label">PESEL</label>
                                <input type="text" id="f-pesel" maxlength="11" placeholder="00000000000">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telefon</label>
                                <input type="tel" id="f-phone" placeholder="+48 500 000 000">
                            </div>
                        </div>

                        <!-- Wiersz 4: Typ pacjenta -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Typ pacjenta *</label>
                                <select id="f-patient-type" required>
                                    <option value="Siedzący">Siedzący</option>
                                    <option value="Leżący">Leżący</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Rodzina może pomóc?</label>
                                <select id="f-family-help">
                                    <option value="Nie">Nie</option>
                                    <option value="Tak">Tak</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="form-section-title">Trasa</h3>

                        <!-- Wiersz 5: Adresy -->
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label class="form-label">Skąd (adres początkowy) *</label>
                                <input type="text" id="f-from" required placeholder="np. Dom, Racibórz ul. Długa 15">
                            </div>
                            <div class="form-group flex-2">
                                <label class="form-label">Dokąd (adres docelowy) *</label>
                                <input type="text" id="f-to" required placeholder="np. Szpital Racibórz, Oddz. Neurologii">
                            </div>
                        </div>

                        <h3 class="form-section-title">Przypisanie</h3>

                        <!-- Wiersz 6: Pracownik + Karetka -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Karetka</label>
                                <select id="f-vehicle">
                                    <option value="">-- Później --</option>
                                    <option value="1">Karetka 1</option>
                                    <option value="2">Karetka 2</option>
                                    <option value="3">Karetka 3</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pracownik 1</label>
                                <select id="f-worker1">
                                    <option value="">-- Później --</option>
                                    <option value="Krzysztof">Krzysztof</option>
                                    <option value="Aleks">Aleks</option>
                                    <option value="Waldemar">Waldemar</option>
                                    <option value="Dawid">Dawid</option>
                                    <option value="Piotrek">Piotrek</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pracownik 2 (leżący)</label>
                                <select id="f-worker2">
                                    <option value="">-- Nie dotyczy --</option>
                                    <option value="Krzysztof">Krzysztof</option>
                                    <option value="Aleks">Aleks</option>
                                    <option value="Waldemar">Waldemar</option>
                                    <option value="Dawid">Dawid</option>
                                    <option value="Piotrek">Piotrek</option>
                                </select>
                            </div>
                        </div>

                        <h3 class="form-section-title">Dodatkowe</h3>

                        <!-- Wiersz 7: Uwagi -->
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label class="form-label">Uwagi medyczne</label>
                                <textarea id="f-medical-notes" rows="2" placeholder="Tlen, defibrylator, specjalne wymagania..."></textarea>
                            </div>
                            <div class="form-group flex-2">
                                <label class="form-label">Inne uwagi</label>
                                <textarea id="f-notes" rows="2" placeholder="Dodatkowe informacje..."></textarea>
                            </div>
                        </div>

                        <!-- Stawki (auto) -->
                        <div class="rate-preview" id="rate-preview" style="display: none;">
                            <div class="rate-info">
                                <span class="material-icons-round">payments</span>
                                <span>Stawka: <strong id="rate-hourly">0</strong> zł/h + <strong id="rate-km">0</strong> zł/km</span>
                            </div>
                        </div>

                        <!-- Przycisk -->
                        <div class="form-actions">
                            <button type="button" class="btn-outline" onclick="resetOrderForm()">Wyczyść</button>
                            <button type="submit" class="btn-primary-lg">
                                <span class="material-icons-round">save</span>
                                Utwórz zlecenie
                            </button>
                        </div>
                    </form>
                </div>
            </section>

            <!-- ==================== LISTA ZLECEŃ ==================== -->
            <section class="view" id="view-orders">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Wszystkie zlecenia</h2>
                        <div class="filters-row">
                            <input type="date" id="filter-date" class="filter-input">
                            <select id="filter-contractor" class="filter-input">
                                <option value="">Wszyscy kontrahenci</option>
                                <option value="Szpital Racibórz">Szpital Racibórz</option>
                                <option value="ScanMed">ScanMed</option>
                                <option value="Kietrz">Kietrz</option>
                                <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                <option value="NFZ">NFZ</option>
                                <option value="Prywatne">Prywatne</option>
                            </select>
                            <select id="filter-status" class="filter-input">
                                <option value="">Wszystkie statusy</option>
                                <option value="Zaplanowane">Zaplanowane</option>
                                <option value="W trasie do pacjenta">W trasie</option>
                                <option value="Z pacjentem">Z pacjentem</option>
                                <option value="Zakończone">Zakończone</option>
                                <option value="Do rozliczenia">Do rozliczenia</option>
                                <option value="Rozliczone">Rozliczone</option>
                            </select>
                            <button class="btn-sm btn-primary" onclick="loadOrdersList()">
                                <span class="material-icons-round">search</span> Szukaj
                            </button>
                        </div>
                    </div>
                    <div class="orders-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Data</th>
                                    <th>Godz.</th>
                                    <th>Pacjent</th>
                                    <th>Skąd</th>
                                    <th>Dokąd</th>
                                    <th>Kontrahent</th>
                                    <th>Pracownik</th>
                                    <th>Status</th>
                                    <th>Kwota</th>
                                </tr>
                            </thead>
                            <tbody id="orders-list-body">
                            </tbody>
                        </table>
                    </div>
                </div>
            </section>

            <!-- ==================== KALKULATOR CEN ==================== -->
            <section class="view" id="view-calculator">
                <div class="panel" style="max-width: 700px;">
                    <div class="panel-header">
                        <h2>Kalkulator cen (transporty prywatne)</h2>
                    </div>
                    <div class="calculator-form">
                        <div class="form-row">
                            <div class="form-group flex-2">
                                <label class="form-label">Skąd</label>
                                <input type="text" id="calc-from" placeholder="Adres początkowy">
                            </div>
                            <div class="form-group flex-2">
                                <label class="form-label">Dokąd</label>
                                <input type="text" id="calc-to" placeholder="Adres docelowy">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Kilometry</label>
                                <input type="number" id="calc-km" placeholder="0" min="0" step="1">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Szacowany czas (h)</label>
                                <input type="number" id="calc-hours" placeholder="0" min="0" step="0.25">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stawka zł/h</label>
                                <input type="number" id="calc-rate-h" value="80" min="0">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Stawka zł/km</label>
                                <input type="number" id="calc-rate-km" value="4" min="0">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Upust/rabat (zł)</label>
                                <input type="number" id="calc-discount" value="0" min="0">
                            </div>
                        </div>
                        <button type="button" class="btn-primary-lg" onclick="calculatePrice()" style="margin-top: 16px;">
                            <span class="material-icons-round">calculate</span>
                            Oblicz cenę
                        </button>

                        <div class="calc-result" id="calc-result" style="display: none;">
                            <div class="calc-result-row">
                                <span>Koszt czasu:</span>
                                <span id="calc-time-cost">0 zł</span>
                            </div>
                            <div class="calc-result-row">
                                <span>Koszt km:</span>
                                <span id="calc-km-cost">0 zł</span>
                            </div>
                            <div class="calc-result-row">
                                <span>Cena bazowa:</span>
                                <span id="calc-base-price">0 zł</span>
                            </div>
                            <div class="calc-result-row">
                                <span>Upust:</span>
                                <span id="calc-discount-val">0 zł</span>
                            </div>
                            <div class="calc-result-row total">
                                <span>CENA FINALNA:</span>
                                <span id="calc-final-price">0 zł</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== ROZLICZENIA ==================== -->
            <section class="view" id="view-reports">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Rozliczenia miesięczne</h2>
                    </div>
                    <div class="form-row" style="margin-bottom: 24px;">
                        <div class="form-group">
                            <label class="form-label">Kontrahent</label>
                            <select id="report-contractor">
                                <option value="Szpital Racibórz">Szpital Racibórz</option>
                                <option value="ScanMed">ScanMed</option>
                                <option value="Kietrz">Kietrz</option>
                                <option value="POZ Krzyżanowice">POZ Krzyżanowice</option>
                                <option value="Prywatne">Prywatne</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Miesiąc</label>
                            <select id="report-month">
                                <option value="1">Styczeń</option>
                                <option value="2" selected>Luty</option>
                                <option value="3">Marzec</option>
                                <option value="4">Kwiecień</option>
                                <option value="5">Maj</option>
                                <option value="6">Czerwiec</option>
                                <option value="7">Lipiec</option>
                                <option value="8">Sierpień</option>
                                <option value="9">Wrzesień</option>
                                <option value="10">Październik</option>
                                <option value="11">Listopad</option>
                                <option value="12">Grudzień</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Rok</label>
                            <input type="number" id="report-year" value="2026" min="2025" max="2030">
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn-sm btn-primary" onclick="loadReport()">
                                <span class="material-icons-round">assessment</span> Pokaż raport
                            </button>
                        </div>
                        <div class="form-group" style="align-self: flex-end;">
                            <button class="btn-sm btn-success" onclick="generateBillingSheet()">
                                <span class="material-icons-round">table_chart</span> Generuj arkusz
                            </button>
                        </div>
                    </div>

                    <!-- Report Results -->
                    <div id="report-results" style="display: none;">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-orders">0</span>
                                    <span class="stat-label">Zleceń</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-hours">0</span>
                                    <span class="stat-label">Godzin</span>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-km">0</span>
                                    <span class="stat-label">Kilometrów</span>
                                </div>
                            </div>
                            <div class="stat-card highlight">
                                <div class="stat-info">
                                    <span class="stat-value" id="report-total">0 zł</span>
                                    <span class="stat-label">Suma</span>
                                </div>
                            </div>
                        </div>
                        <div class="orders-table-container" style="margin-top: 16px;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Data</th>
                                        <th>Pacjent</th>
                                        <th>Trasa</th>
                                        <th>Czas (h)</th>
                                        <th>Km</th>
                                        <th>Kwota czas</th>
                                        <th>Kwota km</th>
                                        <th>Łącznie</th>
                                    </tr>
                                </thead>
                                <tbody id="report-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </section>

            <!-- ==================== PRACOWNICY ==================== -->
            <section class="view" id="view-workers">
                <div class="panel">
                    <div class="panel-header">
                        <h2>Pracownicy</h2>
                    </div>
                    <div class="workers-detail-grid" id="workers-detail-grid">
                        <!-- Wypełniane przez JS -->
                    </div>
                </div>
            </section>

        </div>
    </main>

    <!-- Toast Notification -->
    <div class="toast" id="toast">
        <span class="toast-icon material-icons-round" id="toast-icon">check_circle</span>
        <span class="toast-message" id="toast-message"></span>
    </div>

    <!-- Scripts -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyA0tTZTp2bZBb2cbbSBcnxEoPXERnfx1w8&libraries=places&language=pl"></script>
    <script src="js/utils.js"></script>
    <script src="js/api.js"></script>
    <script src="js/admin.js"></script>
</body>
</html>
